#+TITLE: Dev info
#+STARTUP: noindent

#+begin_src elisp
;; NOTE: self custom func
(yxl-org-babel-show-org-toc)
#+end_src

#+RESULTS:
:  - Filetree
:  - Setting up
:  - Technical information
:    - upstream data archive
:    - conda environment
:    - environment variables
:  - analysis
:    - Key logics

* Files
** Codebase

#+begin_src shell :results code
eza -T --git-ignore ./
#+end_src

#+RESULTS:
#+begin_src shell
.
├── data
│   ├── artifacts
│   ├── intermediate
│   └── raw
├── DEV.org
├── docs
│   ├── environment-bp1.yml
│   ├── environment-non-gpu.yml
│   ├── environment.yml
│   ├── tldraw.tldr
│   └── tom-s-code
│       ├── extract_data.py
│       ├── mrextract_array.sh
│       └── prompts.py
├── Makefile
├── notebooks
│   ├── colab-notebooks
│   │   └── more-models.ipynb
│   ├── more-models-bp1.ipynb
│   ├── more-models.ipynb
│   └── openai
│       └── api-call.ipynb
├── output
│   └── slurm-logs
├── pyproject.toml
├── README.md
├── scripts
│   ├── bp1
│   │   ├── extract-data-pilot-bp1.py
│   │   └── extract-data-pilot-bp1.sbatch
│   ├── isb
│   │   ├── extract-data-array-new-data.py
│   │   ├── extract-data-array-new-data.sbatch
│   │   ├── extract-data-pilot.sbatch
│   │   ├── extract-data.py
│   │   ├── extract-data.sbatch
│   │   └── jupyter.sbatch
│   └── local
└── src
    ├── local_funcs
    │   ├── pyproject.toml
    │   └── src
    │       └── local_funcs
    │           ├── __init__.py
    │           ├── __pycache__
    │           ├── chat_funcs.py
    │           ├── funcs.py
    │           ├── prompt_funcs.py
    │           └── prompt_templates.py
    └── yiutils
        ├── DEVEL.md
        ├── dist
        │   └── yiutils-0.1.0-py3-none-any.whl
        ├── environment.yml
        ├── Makefile
        ├── poetry.lock
        ├── pyproject.toml
        ├── README.md
        ├── scripts
        │   └── sanity.py
        ├── src
        │   └── yiutils
        │       ├── __init__.py
        │       ├── __pycache__
        │       │   ├── __init__.cpython-312.pyc
        │       │   └── project_utils.cpython-312.pyc
        │       ├── failsafe.py
        │       └── project_utils.py
        ├── tests
        │   ├── __init__.py
        │   ├── test_always_true.py
        │   └── test_failsafe.py
        └── TODO.org
#+end_src

** upstream data archive

RDSF:
/projects/MRC-IEU/research/projects/ieu3/p3/015/working/data/llm-data-extraction

#+begin_src shell :results code
ssh epi-franklin2 'eza -T -L 3 /projects/MRC-IEU/research/projects/ieu3/p3/015/working/data/llm-data-extraction'
#+end_src

#+RESULTS:
#+begin_src shell
/projects/MRC-IEU/research/projects/ieu3/p3/015/working/data/llm-data-extraction
├── archives
│   ├── archive-2025-04-27-0
│   │   └── mr-pubmed-abstracts
│   └── archive-2025-04-27-1
│       ├── artifacts
│       ├── intermediate
│       └── raw
└── data
    ├── artifacts
    ├── intermediate
    │   ├── experiement-2025-02-24
    │   └── experiment-2025-03-02
    └── raw
        └── mr-pubmed-abstracts
#+end_src

* Setting up

git clone; git submodule update --init --recursive

bootstrap conda env

inside conda env and at root, install local packages

- local_funcs (src/local_funcs/src/local_funcs): python -m pip install -e src/local_funcs
- yiutils (src/yiutils/src/yiutils): python -m pip install -e src/yiutils

Add .env

* Technical information

** conda environment

conda envs
- ~docs/environment.yml~ / ~data-extraction~: standard gpu env
- ~docs/environment-bp1.yml~ / ~data-extraction-bp1~: bp1 gpu env
- ~docs/environment-non-gpu.yml~ / ~data-extraction-non-gpu~: non gpu env

** environment variables

.env in repo root

- ~HUGGINGFACE_TOKEN~: huggingface token for llama3
- ~OPENAI_API_KEY~: OpenAI API key

* analysis

Overarching principles:
- Unless otherwise specified, run things at repo root

** Key logics

*** Data preparation

*** LLM

- isb
  - scripts/isb/extract-data-pilot.sbatch: pilot run as an entrypoint
  - scripts/isb/extract-data.sbatch: Proper array job for producing data extraction using llama3-8B-Instruct
  - scripts/isb/TODO1: perform extraction on TODO1 data
- bp1
  - ~LATER~
- local
  - ~LATER~
